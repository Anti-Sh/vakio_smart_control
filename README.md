# Vakio Smart Control для Majordomo
 Vakio Smart Control модуль для MajorDomo.

Для корректной работы модуля требуется выполнить следующие шаги:
1. [MQTT-брокер](#broker)
2. [Подключение прибора к брокеру](#connect)
3. [Установка модуля](#setup)

Если столкнулись с ошибками:
- [Возможные ошибки и способы их решения](#errors)
---

## <a name="broker"></a> 1. MQTT-брокер

Взаимодействие осуществляется посредством MQTT, поэтому для функционирования требуется MQTT-брокер (облачный или локальный).
В качестве локального брокера можно использовать [Mosquitto](https://mosquitto.org/download/).

---

## <a name="connect"></a> 2. Подключение прибора к брокеру

Ознакомьтесь с <a target="_blanc" href="https://vakio.ru/vakio-mqtt.pdf">Инструкцией по подключению приборов по MQTT</a>.

Заполните поля в разделе "Настройка MQTT" следующим образом:
1. **Имя сервера MQTT** - ip-адрес сервера Homeassistant.
2. **Порт** - порт "Normal MQTT" ([пункт 1.2.4](#broker_normal_mqtt)), по умолчанию 1883.
3. **Логин** - не заполняется.
4. **Пароль** - не заполняется.
5. **Топик** - произвольно*.

\* *каждый прибор должен иметь уникальный топик.*

***Пример***
```
Имя сервера MQTT: 192.168.0.10
Порт: 1883
Логин:
Пароль:
Топик: vakio_openair1
```

## <a name="setup"></a> 3. Установка модуля

### <a name="setup"></a> 3.1. Основной способ
1. В Majordomo перейдите в **Панель управления** -> **Устройства и службы** -> **Добавить  интеграцию**.
2. В поиске введите "Vakio", в предложенном варианте "Vakio Smart Control" нажмите кнопку "Добавить".
3. Во вкладке "Устройства" нажмите на "Vakio Smart Control", затем, "Настроить".
4. В появившейся форме введите значения, которые вводили в пункте [2. Подключение прибора к брокеру](#connect)


### <a name="setup"></a> 3.2. Альтернативный способ
1. Скачайте [модуль](https://github.com/Anti-Sh/vakio_smart_control/releases/download/majordomo/vakio_smart_control.tar.gz).
2. Перейдите в директорию "C:\\_majordomo\htdocs\" (Windows) или "/var/www/html/" (Linux).
3. Перенесите содержимое архива в папку из п.2.
4. В Majordomo перейдите в **Панель управления** -> **Модули** -> **Vakio Smart Control** -> Кнопка "Карандаш" -> Переустановить.
5. Во вкладке "Устройства" нажмите на "Vakio Smart Control", затем, "Настроить".
6. В появившейся форме введите значения, которые вводили в пункте [2. Подключение прибора к брокеру](#connect).

---

## <a name="errors"></a> Возможные ошибки

### <a name="auth_error"></a> **Не обновляется поле State у устройств**

- Проверьте корректность введенных данных брокера (Хост, порт, имя пользователя и пароль).
- Если всё заполнено правильно, проверьте, подключено ли устройство к брокеру.
